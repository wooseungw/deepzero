# ğŸ“‘ FlexoZero ëª¨ë¸ YAML ê°€ì´ë“œ

> **FlexoZero AutoBuilder** (`flexo/autobuilder.py`)ì—ì„œ ì‚¬ìš©í•  **YAML ê¸°ë°˜ ë„¤íŠ¸ì›Œí¬ ì •ì˜ ë¬¸ë²•**ì„ ì„¤ëª…í•©ë‹ˆë‹¤.
>
> ```python
> from flexo.autobuilder import YamlModel
> model = YamlModel("configs/my_model.yaml")
> ```
>
> ìœ„ì²˜ëŸ¼ í˜¸ì¶œí•˜ë©´ ê³§ë°”ë¡œ ëª¨ë¸ ê°ì²´ê°€ ìƒì„±ë©ë‹ˆë‹¤.

---

## 1. ì „ì²´ YAML ê³¨ê²©

```yaml
in_channels: 3          # (í•„ìˆ˜) ì…ë ¥ ì±„ë„ ìˆ˜
num_classes: 100        # (ì„ íƒ) ì „ì—­ ë³€ìˆ˜, ë¬¸ìì—´ ì¹˜í™˜ìš©
depth_multiple: 1.0     # (ì„ íƒ) ë ˆì´ì–´ ë°˜ë³µ ìŠ¤ì¼€ì¼
width_multiple: 1.0     # (ì„ íƒ) ì±„ë„ ìˆ˜ ìŠ¤ì¼€ì¼

layers:
  #   from  repeat  Block                     positional-args                 kwargs
  - [  -1,     1,   ConvBlock,                64, 3, 2,                      {act: relu, drop: 0.1} ]
  - [  -1,     2,   TransformerEncoderBlock,  128, 4, 8 ]
  - [  -1,     1,   GlobalAvgPool ]
  - [  -1,     1,   LinearBlock,              num_classes,                   {norm: ln} ]
```

## 2. í•„ë“œ ì„¤ëª…

### from
ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©í•  ì´ì „ ë ˆì´ì–´ ì¸ë±ìŠ¤ (-1 = ì§ì „ ë ˆì´ì–´, -2 = ë‘ ë‹¨ê³„ ì „)

### repeat
ë¸”ë¡ ë°˜ë³µ íšŸìˆ˜ (depth_multiple ê°’ì´ ê³±í•´ì§„ ë’¤ ë°˜ì˜¬ë¦¼)

### Block
ì‚¬ìš©í•  ë¸”ë¡ ìœ í˜•: `ConvBlock`, `LinearBlock`, `TransformerEncoderBlock`, `GlobalAvgPool` ë“±

### positional args
ë¸”ë¡ë³„ í•„ìˆ˜ ì¸ì:
- **ConvBlock**: out_channels, kernel_size, stride
- **LinearBlock**: out_features
- **TransformerEncoderBlock**: embed_dim, num_heads, hidden_dim

### kwargs
ì„ íƒì  í•˜ì´í¼íŒŒë¼ë¯¸í„°: act, norm, drop ë“± ê³µí†µ ë§¤ê°œë³€ìˆ˜

## 3. ê³µí†µ í•˜ì´í¼íŒŒë¼ë¯¸í„°

| ì˜µì…˜ | ê°’ | ì ìš© ë¸”ë¡ | ê¸°ë³¸ê°’ |
|------|------|------------|--------|
| act | relu, silu, gelu, tanh | Conv / Linear | relu |
| norm | bn, ln, none | Conv / Linear | bn |
| drop | 0 ~ 1 (í™•ë¥ ) | Conv / Linear | 0 |

ì˜ˆì‹œ: `{act: gelu, norm: ln, drop: 0.25}`

## 4. ì§€ì› ë¸”ë¡ & ì‹œê·¸ë‹ˆì²˜

| ë¸”ë¡ | ìƒì„±ì ì‹œê·¸ë‹ˆì²˜ | ì„¤ëª… |
|------|-------------|------|
| ConvBlock | in_channels, out_channels, kernel_size, stride, act, norm, drop | í•©ì„±ê³± ë¸”ë¡ |
| LinearBlock | in_features, out_features, act, drop | ì™„ì „ ì—°ê²° ë ˆì´ì–´ |
| TransformerEncoderBlock | embed_dim, num_heads, hidden_dim, drop | Transformer ì¸ì½”ë” |
| GlobalAvgPool | - | (B,C,H,W) â†’ (B,C) |

ìƒˆ ë¸”ë¡ì„ ì¶”ê°€í•˜ë ¤ë©´:

```python
class MyBlock(Model):
    # ë¸”ë¡ êµ¬í˜„
    ...

# ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡
BLOCK_REGISTRY['MyBlock'] = MyBlock
```

## 5. ì „ì—­ ë³€ìˆ˜ ì¹˜í™˜

```yaml
num_classes: 10
layers:
  - [ -1, 1, LinearBlock, num_classes ]   # â‡’ out_features = 10
```

## 6. ì˜ˆì‹œ â€“ VGG16 ëª¨ë¸

```yaml
# vgg16.yaml - MNISTìš© VGG16 ëª¨ë¸
in_channels: 1
num_classes: 10
depth_multiple: 1.0
width_multiple: 0.5   # ì±„ë„ ì ˆë°˜ìœ¼ë¡œ ì¶•ì†Œ

layers:
  # Block 1
  - [-1, 1, ConvBlock, 64, 3, 1, {act: relu, norm: bn}]
  - [-1, 1, ConvBlock, 64, 3, 1, {act: relu, norm: bn}]
  - [-1, 1, ConvBlock, 64, 2, 2, {act: relu}]

  # Block 2
  - [-1, 1, ConvBlock, 128, 3, 1, {act: relu, norm: bn}]
  - [-1, 1, ConvBlock, 128, 3, 1, {act: relu, norm: bn}]
  - [-1, 1, ConvBlock, 128, 2, 2, {act: relu}]

  # íŠ¹ì„± í‰íƒ„í™” (Flatten)
  - [-1, 1, GlobalAvgPool, 0]

  # ì™„ì „ ì—°ê²° ë ˆì´ì–´
  - [-1, 1, LinearBlock, 512, 0, 0, {act: relu, drop: 0.5}]
  - [-1, 1, LinearBlock, 10, 0, 0, {}]
```

## 7. ê³ ê¸‰ íŒ

| ëª©ì  | ë°©ë²• |
|------|------|
| ëª¨ë¸ í¬ê¸° ì¡°ì • | depth_multiple, width_multiple ê°’ ì¡°ì • |
| Dropout ë¹„í™œì„±í™” | drop: 0 ë˜ëŠ” ìƒëµ |
| BatchNorm ì—†ëŠ” Conv | {norm: none} |
| LayerNorm ì‚¬ìš© | {norm: ln} |
| ë‹¤ì–‘í•œ í™œì„±í™” í•¨ìˆ˜ | ë°˜ë³µ ë¸”ë¡ì„ ë³„ë„ ë ˆì´ì–´ë¡œ ì„ ì–¸í•˜ê³  ê°ê° ë‹¤ë¥¸ act ì§€ì • |

## 8. ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ & í•´ê²°ë²•

| ì˜¤ë¥˜ | ì›ì¸ / í•´ê²° |
|------|------------|
| ì°¨ì› ë¶ˆì¼ì¹˜ ì˜¤ë¥˜ | ë ˆì´ì–´ ê°„ ì…ì¶œë ¥ ì±„ë„ ìˆ˜ í™•ì¸, íŠ¹íˆ GlobalAvgPool í›„ ì°¨ì› í™•ì¸ |
| ë¸”ë¡ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì˜¤ë¥˜ | YAMLì— ëª…ì‹œëœ ë¸”ë¡ ì´ë¦„ì´ ì‹¤ì œ ë“±ë¡ëœ í´ë˜ìŠ¤ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸ |
| í˜•ìƒ ë³€í™˜ ë¬¸ì œ | Convì™€ Linear ì—°ê²° ì‹œ ì°¨ì› ê³„ì‚° ë¬¸ì œ, reshape í•„ìš” ì—¬ë¶€ í™•ì¸ |

## 9. ëª¨ë¸ ë¹Œë“œ & í…ŒìŠ¤íŠ¸ ì½”ë“œ

```python
import numpy as np
import flexo
from flexo.autobuilder import YamlModel

# ëª¨ë¸ ìƒì„±
model = YamlModel("configs/vgg16.yaml")

# í…ŒìŠ¤íŠ¸ ì…ë ¥
x = flexo.Variable(np.random.randn(1, 1, 28, 28).astype(np.float32))

# ìˆœì „íŒŒ
y = model(x)
print(f"ì¶œë ¥ í˜•ìƒ: {y.shape}")  # ì˜ˆìƒ ì¶œë ¥: (1, 10)

# ëª¨ë¸ í•™ìŠµ
optimizer = flexo.optimizers.Adam().setup(model)
# ... í•™ìŠµ ë£¨í”„ êµ¬í˜„ ...
```

ì´ ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ë‹¤ì–‘í•œ ëª¨ë¸ì„ ììœ ë¡­ê²Œ ì„¤ê³„í•´ ë³´ì„¸ìš”!
